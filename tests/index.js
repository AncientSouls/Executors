'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _chai=require('chai');var _lib=require('../lib');var _ancientGraph=require('ancient-graph');var _async=require('async');var _async2=_interopRequireDefault(_async);var _each=require('async/each');var _each2=_interopRequireDefault(_each);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}require('source-map-support').install();describe('AncientSouls/Funicular',function(){describe('core',function(){function generateManager(){return new _lib.Manager(function(_Item){_inherits(_class,_Item);function _class(){_classCallCheck(this,_class);return _possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).apply(this,arguments))}_createClass(_class,[{key:'preparation',value:function preparation(callback){this.prepared(undefined,callback)}},{key:'mounting',value:function mounting(callback){this.mounted(undefined,callback)}}]);return _class}(_lib.Item))};it('should check full lifecicle of one item',function(done){var manager=generateManager();manager.get('a').prepare(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(item.isPrepared);_chai.assert.equal(manager._items.a,item);item.mount(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(item.isMounted);item.remount(undefined,function(oldE,oldI,newE,newI){_chai.assert.ifError(oldE);_chai.assert.ifError(newE);_chai.assert.isTrue(oldI.isUnmounted);_chai.assert.isTrue(newI.isMounted);_chai.assert.isNotOk(newI.isUnmounted);_chai.assert.isOk(manager._items.a==newI);_chai.assert.isNotOk(manager._items.a==oldI);newI.unmount(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(item.isUnmounted);_chai.assert.isNotOk(manager._items.a);done()})})})})})});describe('hierarchical',function(){function generateManager(memory){return new _lib.Manager(function(_Item2){_inherits(_class2,_Item2);function _class2(){_classCallCheck(this,_class2);return _possibleConstructorReturn(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}_createClass(_class2,[{key:'preparation',value:function preparation(callback){this.data=memory[this.name];for(var c in this.data.childs){this.prepareChild(this.data.childs[c])}this.prepared(undefined,callback)}},{key:'mounting',value:function mounting(callback){var _this3=this;(0,_each2.default)(this.childs,function(child,next){_this3.mountChild(child,function(){next()})},function(){return _this3.mounted(undefined,callback)})}}]);return _class2}(_lib.Item))};it('should prepare, mount, unmount all',function(done){var memory={a:{childs:['b']},b:{childs:['c']},c:{}};var manager=generateManager(memory);manager.get('a').prepare(function(error,item){_chai.assert.ifError(error);var a=item;var b=item.childs.b;var c=item.childs.b.childs.c;_chai.assert.equal(manager._items.a,a);_chai.assert.equal(manager._items.b,b);_chai.assert.equal(manager._items.c,c);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,0);_chai.assert.isTrue(a.isPrepared);_chai.assert.isTrue(b.isPrepared);_chai.assert.isTrue(c.isPrepared);item.mount(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(a.isMounted);_chai.assert.isTrue(b.isMounted);_chai.assert.isTrue(c.isMounted);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,0);item.unmount(function(error,item){_chai.assert.isNotOk(manager._items.a);_chai.assert.isNotOk(manager._items.b,b);_chai.assert.isNotOk(manager._items.c,c);_chai.assert.isTrue(a.isUnmounted);_chai.assert.isTrue(b.isUnmounted);_chai.assert.isTrue(c.isUnmounted);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,0);done()})})})});it('should check simple recursion',function(done){var memory={a:{childs:['b']},b:{childs:['c']},c:{childs:['a']}};var manager=generateManager(memory);manager.get('a').prepare(function(error,item){_chai.assert.ifError(error);var a=item;var b=item.childs.b;var c=item.childs.b.childs.c;_chai.assert.equal(manager._items.a,a);_chai.assert.equal(manager._items.b,b);_chai.assert.equal(manager._items.c,c);_chai.assert.isTrue(a.isPrepared);_chai.assert.isTrue(b.isPrepared);_chai.assert.isTrue(c.isPrepared);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,1);item.mount(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(a.isMounted);_chai.assert.isTrue(b.isMounted);_chai.assert.isTrue(c.isMounted);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,1);item.unmount(function(error,item){_chai.assert.isNotOk(manager._items.a);_chai.assert.isNotOk(manager._items.b,b);_chai.assert.isNotOk(manager._items.c,c);_chai.assert.isTrue(a.isUnmounted);_chai.assert.isTrue(b.isUnmounted);_chai.assert.isTrue(c.isUnmounted);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,1);done()})})})});it('should check many recursions',function(done){var memory={a:{childs:['b']},b:{childs:['c']},c:{childs:['a','d']},d:{childs:['e']},e:{childs:['f']},f:{childs:['d','a']}};var manager=generateManager(memory);manager.get('a').prepare(function(error,item){_chai.assert.ifError(error);var a=item;var b=item.childs.b;var c=b.childs.c;var d=c.childs.d;var e=d.childs.e;var f=e.childs.f;_chai.assert.equal(manager._items.a,a);_chai.assert.equal(manager._items.b,b);_chai.assert.equal(manager._items.c,c);_chai.assert.equal(manager._items.d,d);_chai.assert.equal(manager._items.e,e);_chai.assert.equal(manager._items.f,f);_chai.assert.isTrue(a.isPrepared);_chai.assert.isTrue(b.isPrepared);_chai.assert.isTrue(c.isPrepared);_chai.assert.isTrue(d.isPrepared);_chai.assert.isTrue(e.isPrepared);_chai.assert.isTrue(f.isPrepared);_chai.assert.lengthOf(f.parents,1);_chai.assert.lengthOf(e.parents,1);_chai.assert.lengthOf(d.parents,2);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,2);item.mount(function(error,item){_chai.assert.ifError(error);_chai.assert.isTrue(a.isMounted);_chai.assert.isTrue(b.isMounted);_chai.assert.isTrue(c.isMounted);_chai.assert.isTrue(d.isMounted);_chai.assert.isTrue(e.isMounted);_chai.assert.isTrue(f.isMounted);_chai.assert.lengthOf(f.parents,1);_chai.assert.lengthOf(e.parents,1);_chai.assert.lengthOf(d.parents,2);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,2);item.unmount(function(error,item){_chai.assert.isNotOk(manager._items.a);_chai.assert.isNotOk(manager._items.b);_chai.assert.isNotOk(manager._items.c);_chai.assert.isNotOk(manager._items.d);_chai.assert.isNotOk(manager._items.e);_chai.assert.isNotOk(manager._items.f);_chai.assert.isTrue(a.isUnmounted);_chai.assert.isTrue(b.isUnmounted);_chai.assert.isTrue(c.isUnmounted);_chai.assert.isTrue(d.isUnmounted);_chai.assert.isTrue(e.isUnmounted);_chai.assert.isTrue(f.isUnmounted);_chai.assert.lengthOf(f.parents,1);_chai.assert.lengthOf(e.parents,1);_chai.assert.lengthOf(d.parents,2);_chai.assert.lengthOf(c.parents,1);_chai.assert.lengthOf(b.parents,1);_chai.assert.lengthOf(a.parents,2);done()})})})})});describe('realistic',function(){function generateManager(memory){return new _lib.Manager(function(_Item3){_inherits(_class3,_Item3);function _class3(){_classCallCheck(this,_class3);return _possibleConstructorReturn(this,(_class3.__proto__||Object.getPrototypeOf(_class3)).apply(this,arguments))}_createClass(_class3,[{key:'preparation',value:function preparation(callback){this.data=memory[this.name];for(var c in this.data.childs){this.prepareChild(this.data.childs[c])}this.exports={};this.prepared(undefined,callback)}},{key:'mounting',value:function mounting(callback){var _this5=this;var item=this;(0,_each2.default)(this.childs,function(child,next){_this5.mountChild(child,function(){next()})},function(){if(_this5.data.type=='js'){eval(_this5.data.data)}else if(_this5.data.type=='css'){_this5.exports=_this5.data.data;_this5.manager.get('a').exports[_this5.name]=_this5.exports}else if(_this5.data.type=='root'){}_this5.mounted(undefined,callback)})}},{key:'unmounting',value:function unmounting(callback){for(var c in this.childs){this.childs[c].unmount()}if(this.data.type=='css'){delete this.manager.get('a').exports[this.name]}this.unmounted(undefined,callback)}}]);return _class3}(_lib.Item))};it('should check fake js and css items',function(done){var memory={a:{childs:['b'],type:'root'},b:{childs:['c','e'],type:'js',data:'item.exports = item.data'},c:{childs:['d'],type:'js',data:'item.exports = item.data'},d:{type:'css',data:'body { color: black; }'},e:{childs:['d'],type:'js',data:'item.exports = item.data'}};var manager=generateManager(memory);manager.get('a').prepare(function(error,item){item.mount(function(error,item){_chai.assert.equal(manager._items.a.data,memory.a);_chai.assert.equal(manager._items.b.data,memory.b);_chai.assert.equal(manager._items.c.data,memory.c);_chai.assert.equal(manager._items.d.data,memory.d);_chai.assert.equal(manager._items.e.data,memory.e);_chai.assert.equal(item.exports.d,manager._items.d.exports);item.unmount(function(error,item){_chai.assert.isNotOk(manager._items.a);_chai.assert.isNotOk(manager._items.b);_chai.assert.isNotOk(manager._items.c);_chai.assert.isNotOk(manager._items.d);_chai.assert.isNotOk(manager._items.e);_chai.assert.isNotOk(item.exports.d);done()})})})})})});
//# sourceMappingURL=index.js.map