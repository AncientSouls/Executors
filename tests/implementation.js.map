{"version":3,"sources":["../src/tests/implementation.js"],"names":["Item","isMounted","Promise","resolve","data","reject","type","get","then","typeItem","getResult","mount","call","catch","result","item","Error","id","all","Object","keys","childs","map","c","unmount","child","unset","Module","children","parent","loaded","exports","js","module","set","runInNewContext","code","require","name","undefined"],"mappings":"knBAAA,2BAGA,sB,qCACA,+B,06BAEA;GACMA,K,8PACI,iBACN,GAAI,KAAKC,SAAL,EAAJ,CAAsB,MAAOC,SAAQC,OAAR,CAAgB,IAAhB,CAAP,CACtB,GAAI,CAAC,KAAKC,IAAV,CAAgB,MAAOF,SAAQG,MAAR,CAAe,mBAAf,CAAP,CAEhB,MAAO,IAAIH,QAAJ,CAAY,SAACC,OAAD,CAAUE,MAAV,CAAqB,CACtC,GAAI,OAAKD,IAAL,CAAUE,IAAd,CAAoB,CAClB;AACA,OAAKC,GAAL,CAAS,OAAKH,IAAL,CAAUE,IAAnB,EAAyBE,IAAzB,CAA8B,SAACC,QAAD,CAAc,CAC1C,GAAIH,MAAOG,SAASC,SAAT,EAAX,CACA,GAAIJ,KAAKK,KAAT,CAAgBL,KAAKK,KAAL,CAAWC,IAAX,SAAsBJ,IAAtB,CAA2B,iBAAML,gBAAN,CAA3B,CAAgDE,MAAhD,EAAhB,IACKF,gBACN,CAJD,EAIGU,KAJH,CAISR,MAJT,CAKD,CAPD,IAOO,CACL;AACA,OAAKK,SAAL,CAAiB,iBAAM,QAAKN,IAAL,CAAUU,MAAhB,CAAjB,CACAX,eACD,CACF,CAbM,EAaJK,IAbI,CAaC,SAACO,IAAD,CAAU,CAChB,GAAI,CAACA,KAAKd,SAAL,EAAL,CAAuB,KAAM,IAAIe,MAAJ,gBAAyB,OAAKZ,IAAL,CAAUa,EAAnC,cAAkD,OAAKb,IAAL,CAAUE,IAA5D,yDAAN,CACvB,MAAOS,KACR,CAhBM,CAiBR,C,yCACS,iBACR,GAAI,CAAC,KAAKd,SAAL,EAAL,CAAuB,MAAOC,SAAQC,OAAR,CAAgB,IAAhB,CAAP,CAEvB,MAAO,MAAKO,SAAZ,CAEA,MAAOR,QACP;AADO,CAENgB,GAFM,CAEFC,OAAOC,IAAP,CAAY,KAAKC,MAAjB,EAAyBC,GAAzB,CAA6B,SAACC,CAAD,QAChC,QAAKF,MAAL,CAAYE,CAAZ,EAAeC,OAAf,GAAyBhB,IAAzB,CAA8B,SAACiB,KAAD,QAAW,QAAKC,KAAL,CAAWD,KAAX,CAAX,CAA9B,CADgC,CAA7B,CAFE,EAKNjB,IALM,CAKD,UAAM,CACV;AACA,GAAI,CAAC,OAAKJ,IAAL,CAAUE,IAAf,CAAqB,cAErB;AACA,MAAO,QAAKC,GAAL,CAAS,OAAKH,IAAL,CAAUE,IAAnB,EAAyBE,IAAzB,CAA8B,SAACC,QAAD,CAAc,CACjD,GAAIH,MAAOG,SAASC,SAAT,EAAX,CACA,GAAIJ,KAAKkB,OAAT,CAAkB,MAAOlB,MAAKkB,OAAL,CAAaZ,IAAb,QAAP,CAAlB,IACK,OACN,CAJM,EAIJJ,IAJI,CAIC,yBAJD,CAKR,CAfM,CAgBR,C,4BAGH;;;GAKA;;GAIA;;;GAKA;;;;;GAQA,GAAImB,QAAS,QAATA,OAAS,CAASV,EAAT,CAAaF,IAAb,CAAmB,CAC9B,KAAKE,EAAL,CAAUA,EAAV,CACA,KAAKW,QAAL,CAAgB,EAAhB,CACA,KAAKC,MAAL,CAAc,IAAd,CACA,KAAKC,MAAL,CAAc,KAAd,CACA,KAAKC,OAAL,CAAe,EAAf,CACA,KAAKhB,IAAL,CAAYA,IACb,CAPD,CASA,GAAIiB,IAAK,CACPlB,OAAQ,CACNH,KADM,iBACE,iBACN,GAAIsB,QAAS,GAAIN,OAAJ,CAAW,KAAKvB,IAAL,CAAUa,EAArB,CAAyB,IAAzB,CAAb,CACA,KAAKP,SAAL,CAAiB,iBAAMuB,QAAOF,OAAb,CAAjB,CAEA,GAAIV,QAAS,EAAb,CACA,GAAI,KAAKjB,IAAL,CAAUiB,MAAd,CAAsB,IAAK,GAAIE,EAAT,GAAc,MAAKnB,IAAL,CAAUiB,MAAxB,EACpBA,OAAOE,CAAP,EAAY,KAAKhB,GAAL,CAAS,KAAKH,IAAL,CAAUiB,MAAV,CAAiBE,CAAjB,CAAT,EAA8Bf,IAA9B,CAAmC,SAACiB,KAAD,CAAW,CACxD,OAAKS,GAAL,CAASX,CAAT,CAAYE,KAAZ,EACA,MAAOA,MACR,CAHW,CADQ,CAMtB,MAAO,qBAAaJ,MAAb,EAAqBb,IAArB,CAA0B,SAACa,MAAD,CAAY,CAC3C,aAAGc,eAAH,CAAmB,OAAK/B,IAAL,CAAUgC,IAA7B,CAAmC,CACjCH,aADiC,CAEjCI,QAAS,iBAACC,IAAD,QAAUjB,QAAOiB,IAAP,EAAa5B,SAAb,CAAyBW,OAAOiB,IAAP,EAAa5B,SAAb,EAAzB,CAAoD6B,SAA9D,CAFwB,CAAnC,EAKA,aACD,CAPM,CAQR,CApBK,CADD,CAAT,C,QA0BEZ,M,CAAAA,M,SACA3B,I,CAAAA,I,SACAgC,E,CAAAA,E","file":"implementation.js","sourcesContent":["import {\n  Item as ProtoItem,\n} from '../lib';\nimport vm from 'vm';\nimport PromiseProps from 'p-props';\n\n// Freely extend this class with your custom logic.\nclass Item extends ProtoItem {\n  mount() {\n    if (this.isMounted()) return Promise.resolve(this);\n    if (!this.data) return Promise.reject('Data not founded.');\n    \n    return new Promise((resolve, reject) => {\n      if (this.data.type) {\n        // Support for custom type mounter.\n        this.get(this.data.type).then((typeItem) => {\n          var type = typeItem.getResult();\n          if (type.mount) type.mount.call(this).then(() => resolve(this), reject);\n          else resolve(this);\n        }).catch(reject);\n      } else {\n        // Support for non-stored, system data types.\n        this.getResult = () => this.data.result;\n        resolve(this);\n      }\n    }).then((item) => {\n      if (!item.isMounted()) throw new Error(`Item { id: \"${this.data.id}\", type: \"${this.data.type}\" } is not mounted. Type not define getResult method.`);\n      return item;\n    });\n  }\n  unmount() {\n    if (!this.isMounted()) return Promise.resolve(this);\n    \n    delete this.getResult;\n    \n    return Promise\n    // Unmount and unset childs before try unmount current item.\n    .all(Object.keys(this.childs).map((c) => (\n      this.childs[c].unmount().then((child) => this.unset(child))\n    )))\n    .then(() => {\n      // System non-stored data, is not unmountable.\n      if (!this.data.type) return this;\n      \n      // Load custom type unmounter.\n      return this.get(this.data.type).then((typeItem) => {\n        var type = typeItem.getResult();\n        if (type.unmount) return type.unmount.call(this);\n        else this;\n      }).then(() => this);\n    })\n  }\n}\n\n/**\n * @name Item#data\n * @type {Link=}\n */\n\n/**\n * @interface Data\n */\n\n/**\n * @name Data#id\n * @type {string=}\n */\n\n/**\n * @name Data#type\n * @type {string=}\n * @descirption\n * If is undefined, result gets from data.result directly, without mounting.\n */\n\n\nvar Module = function(id, item) {\n  this.id = id;\n  this.children = [];\n  this.parent = null;\n  this.loaded = false;\n  this.exports = {};\n  this.item = item;\n};\n\nvar js = {\n  result: {\n    mount() {\n      var module = new Module(this.data.id, this);\n      this.getResult = () => module.exports;\n      \n      var childs = {};\n      if (this.data.childs) for (var c in this.data.childs)\n        childs[c] = this.get(this.data.childs[c]).then((child) => {\n          this.set(c, child);\n          return child;\n        });\n      \n      return PromiseProps(childs).then((childs) => {\n        vm.runInNewContext(this.data.code, {\n          module,\n          require: (name) => childs[name].getResult ? childs[name].getResult() : undefined,\n        });\n        \n        return this;\n      });\n    },\n  },\n};\n\nexport {\n  Module,\n  Item,\n  js,\n};"]}